#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üîç Running server ESLint..."
cd tenebra-server && npm run lint && cd ..

echo ""
echo "üîç Running web lint..."
cd tenebra-web && npm run lint && cd ..

echo ""
echo "Running Semgrep security checks..."
if command -v semgrep >/dev/null 2>&1; then
  semgrep scan \
    --config=p/security-audit \
    --config=p/secrets \
    --config=p/owasp-top-ten \
    --config=p/nodejs \
    --config=p/react \
    --config=p/typescript \
    --error \
    --quiet \
    || {
      echo "‚ùå Semgrep found security issues!"
      echo "To skip this check (not recommended): git commit --no-verify"
      exit 1
    }
  echo "‚úÖ Semgrep checks passed!"
else
  echo "‚ö†Ô∏è  Semgrep not installed. Install with: pip install semgrep"
  echo "   Skipping Semgrep checks..."
fi
